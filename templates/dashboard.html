{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <!-- Header Row -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="mb-0" id="stockTitle">Loading...</h1>
                    <small class="text-muted" id="lastUpdated">Last updated: --</small>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline-secondary" id="refreshBtn">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                    <button class="btn btn-outline-primary" id="downloadCsvBtn">
                        <i class="bi bi-download"></i> Export CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards Row -->
    <div class="row mb-4" id="kpiCards">
        <!-- Current Price -->
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card kpi-card">
                <div class="card-body">
                    <div class="kpi-icon bg-primary">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                    <div class="kpi-content">
                        <h6 class="text-muted mb-1">Current Price</h6>
                        <h3 class="mb-0" id="currentPrice">--</h3>
                        <small id="priceChange" class="text-secondary">--</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Predicted Close -->
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card kpi-card">
                <div class="card-body">
                    <div class="kpi-icon bg-info">
                        <i class="bi bi-lightning-charge"></i>
                    </div>
                    <div class="kpi-content">
                        <h6 class="text-muted mb-1">Predicted Close</h6>
                        <h3 class="mb-0" id="predictedClose">--</h3>
                        <small id="predictedChange" class="text-secondary">Tomorrow</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Trend Signal -->
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card kpi-card">
                <div class="card-body">
                    <div class="kpi-icon" id="trendIconBg">
                        <i class="bi bi-arrow-up-right" id="trendIcon"></i>
                    </div>
                    <div class="kpi-content">
                        <h6 class="text-muted mb-1">Trend Signal</h6>
                        <h3 class="mb-0" id="trendSignal">--</h3>
                        <small class="text-secondary" id="trendDetail">MA20 vs MA50</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Volatility -->
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card kpi-card">
                <div class="card-body">
                    <div class="kpi-icon bg-warning">
                        <i class="bi bi-activity"></i>
                    </div>
                    <div class="kpi-content">
                        <h6 class="text-muted mb-1">30D Volatility</h6>
                        <h3 class="mb-0" id="volatility">--</h3>
                        <small class="text-secondary" id="volatilityDesc">Annualized</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Main Price Chart -->
        <div class="col-lg-8 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-graph-up"></i> Price Chart</h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-secondary chart-range active" data-days="30">1M</button>
                            <button class="btn btn-outline-secondary chart-range" data-days="90">3M</button>
                            <button class="btn btn-outline-secondary chart-range" data-days="180">6M</button>
                            <button class="btn btn-outline-secondary chart-range" data-days="365">1Y</button>
                        </div>
                    </div>
                    <div class="mt-2">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input indicator-toggle" type="checkbox" id="showMA20" checked>
                            <label class="form-check-label" for="showMA20">
                                <span class="indicator-badge ma20">MA20</span>
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input indicator-toggle" type="checkbox" id="showMA50" checked>
                            <label class="form-check-label" for="showMA50">
                                <span class="indicator-badge ma50">MA50</span>
                            </label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input indicator-toggle" type="checkbox" id="showBB">
                            <label class="form-check-label" for="showBB">
                                <span class="indicator-badge bb">Bollinger</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="priceChart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
        
        <!-- 5-Day Forecast Panel -->
        <div class="col-lg-4 mb-4">
            <div class="card forecast-card h-100">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-calendar-week"></i> 5-Day Forecast</h5>
                </div>
                <div class="card-body">
                    <div id="forecastSummary">
                        <div class="text-center py-4">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive mt-3">
                        <table class="table table-sm table-hover" id="forecastTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Close</th>
                                    <th>Range</th>
                                </tr>
                            </thead>
                            <tbody id="forecastTableBody">
                                <tr><td colspan="3" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Row -->
    <div class="row mb-4">
        <!-- Volatility Chart -->
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Rolling Volatility</h5>
                </div>
                <div class="card-body">
                    <div id="volatilityChart" style="height: 250px;"></div>
                </div>
            </div>
        </div>
        
        <!-- Returns Distribution -->
        <div class="col-lg-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-distribute-vertical"></i> Returns Distribution</h5>
                </div>
                <div class="card-body">
                    <div id="returnsHistogram" style="height: 250px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Risk & Performance Metrics -->
    <div class="row mb-4">
        <div class="col-lg-4 mb-4">
            <div class="card metrics-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-shield-check"></i> Risk Metrics</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush" id="riskMetrics">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Max Drawdown</span>
                            <strong id="maxDrawdown">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>VaR (95%)</span>
                            <strong id="var95">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Best Day</span>
                            <strong id="bestDay" class="text-success">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Worst Day</span>
                            <strong id="worstDay" class="text-danger">--</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="card metrics-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-graph-up-arrow"></i> Technical Signals</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush" id="technicalSignals">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>RSI (14)</span>
                            <strong id="rsiValue">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>RSI Signal</span>
                            <span class="badge" id="rsiSignal">--</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Support (S1)</span>
                            <strong id="support1">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Resistance (R1)</span>
                            <strong id="resistance1">--</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="card metrics-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-cpu"></i> Model Performance</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush" id="modelMetrics">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>RMSE</span>
                            <strong id="modelRmse">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Naive RMSE</span>
                            <strong id="naiveRmse">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Skill Score</span>
                            <strong id="skillScore">--</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Direction Acc.</span>
                            <strong id="directionAcc">--</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
